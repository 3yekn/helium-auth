# Prequisites
- install DIDKit: https://spruceid.dev/docs/didkit/install
- put didkit and didkit-http in path

# Create identities
- Homium Owner = the overall identity in charge of managing Homium-related credentials
- Homium Approver = the identity that will have the authority to approve new Homium deals

## Generate keys
The following commands creates 2 separate keys for the above identities. IRL, these would be assigned to persons and that person would be the only one with access to the private key material.

``` bash
didkit generate-ed25519-key > homium-owner.jwk
didkit generate-ed25519-key > homium-approver.jwk
```

> NOTE: If you want to use the exact same values, the private keys I generated are:
``` bash
cat homium-owner.jwk && cat homium-approver.jwk
{"kty":"OKP","crv":"Ed25519","x":"qXHQvGKRhj_cGftzhbN_-jfG9CQPIEgrZRGhrQaehGk","d":"8_01zhCGuzOW35hDXURVerqGU0jBmCK5zaVb62lG3Cw"}
{"kty":"OKP","crv":"Ed25519","x":"JrfZ0SQPAe1eCmsSAyTO9yd0Zyt8gXrigsgw-AEs7n8","d":"I_lWe1soB0QsTYTpUS3mVn_O45CdHjnDjwYsFUGlPzs"}
```

## Generate DIDs
``` bash
didkit key-to-did key --key-path homium-owner.jwk > homium-owner.did
didkit key-to-did key --key-path homium-approver.jwk > homium-approver.did
```

# Generate verification method
``` bash
didkit key-to-verification-method --key-path homium-owner.jwk > homium-owner.verification-method
```

# Example credential 
Use the ```homium-owner``` DID as the issuer and the ```homium-approver``` as the credential subject.
``` json
{
    "@context": "https://www.w3.org/2018/credentials/v1",
    "id": "https://credit-suisse.com/credentials/digital-assets/homium/approve",
    "type": ["VerifiableCredential"],
    "issuer": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
    "issuanceDate": "2021-07-19T21:41:50Z",
    "credentialSubject": {
        "id": "did:key:z6Mkh4Q8sq4kj9dUAK63j4vXfM2AMmvkz1qqGbNxXqBfHiez"
    }
}
```

# Start the HTTP server (as Homium owner)
``` bash
didkit-http -p 9999 --key-path homium-owner.jwk & pid=$!
didkit_url=http://localhost:9999
```

# Issue a signed credential
``` bash

curl -fsS $didkit_url/issue/credentials \
    -H 'Content-Type: application/json' \
    -o homium-approve-credential-signed.jsonld \
    -d '{
    "credential": {
        "@context": "https://www.w3.org/2018/credentials/v1",
        "id": "https://credit-suisse.com/credentials/digital-assets/homium/approve",
        "type": ["VerifiableCredential"],
        "issuer": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
        "issuanceDate": "2021-07-19T21:41:50Z",
        "credentialSubject": {
            "id": "did:key:z6Mkh4Q8sq4kj9dUAK63j4vXfM2AMmvkz1qqGbNxXqBfHiez"
        }
    },
   "options": {
        "verificationMethod": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL#z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
        "proofPurpose": "assertionMethod"
   }
 }'
```

## Review the signed credential
The proof, and in particular, the ```jws``` (JSON Web Signature), can ONLY be generated by the ```homium-owner``` and it can be cryptographically verified by anyone.
``` json
{
  "@context": "https://www.w3.org/2018/credentials/v1",
  "id": "https://credit-suisse.com/credentials/digital-assets/homium/approve",
  "type": [
    "VerifiableCredential"
  ],
  "credentialSubject": {
    "id": "did:key:z6Mkh4Q8sq4kj9dUAK63j4vXfM2AMmvkz1qqGbNxXqBfHiez"
  },
  "issuer": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
  "issuanceDate": "2021-07-19T21:41:50Z",
  "proof": {
    "type": "Ed25519Signature2018",
    "proofPurpose": "assertionMethod",
    "verificationMethod": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL#z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
    "created": "2021-07-19T16:28:27.841Z",
    "jws": "eyJhbGciOiJFZERTQSIsImNyaXQiOlsiYjY0Il0sImI2NCI6ZmFsc2V9..t9N_yZbikIqApFSNRLW86fV0E-ue64Wb_62rTNTzAnLIYcC-X79eiloL5pCl565iORud2wWMekiM3Pp1LaP3Cw"
  }
}
```

# Verify the credential
Any party can verify the validity of the credential. 

```didkit``` reports that it has checked the proof and it is valid. No secrets are needed to verify a credential.

``` bash
didkit vc-verify-credential -v did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL#z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL -p assertionMethod < homium-approve-credential-signed.jsonld

{"checks":["proof"],"warnings":[],"errors":[]}
```

# Create a presentation of the credential
The specific presentation of a credential... 
``` json
{
  "@context": ["https://www.w3.org/2018/credentials/v1"],
  "id": "https://credit-suisse.com/presentations/digital-assets/homium/approve",
  "type": ["VerifiablePresentation"],
  "holder": "did:key:z6Mkh4Q8sq4kj9dUAK63j4vXfM2AMmvkz1qqGbNxXqBfHiez",
  "verifiableCredential": {
    "@context": "https://www.w3.org/2018/credentials/v1",
    "id": "https://credit-suisse.com/credentials/digital-assets/homium/approve",
    "type": ["VerifiableCredential"],
    "credentialSubject": {
      "id": "did:key:z6Mkh4Q8sq4kj9dUAK63j4vXfM2AMmvkz1qqGbNxXqBfHiez"
    },
    "issuer": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
    "issuanceDate": "2021-07-19T21:41:50Z",
    "proof": {
      "type": "Ed25519Signature2018",
      "proofPurpose": "assertionMethod",
      "verificationMethod": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL#z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
      "created": "2021-07-19T16:28:27.841Z",
      "jws": "eyJhbGciOiJFZERTQSIsImNyaXQiOlsiYjY0Il0sImI2NCI6ZmFsc2V9..t9N_yZbikIqApFSNRLW86fV0E-ue64Wb_62rTNTzAnLIYcC-X79eiloL5pCl565iORud2wWMekiM3Pp1LaP3Cw"
    }
  }
}
```

## Sign the presentation
```
 curl -fsS $didkit_url/prove/presentations \
    -H 'Content-Type: application/json' \
    -o presentation-signed.jsonld \
    -d '{
  "presentation": {
    "@context": ["https://www.w3.org/2018/credentials/v1"],
    "id": "https://credit-suisse.com/presentations/digital-assets/homium/approve",
    "type": ["VerifiablePresentation"],
    "holder": "did:key:z6Mkh4Q8sq4kj9dUAK63j4vXfM2AMmvkz1qqGbNxXqBfHiez",
    "verifiableCredential": {
      "@context": "https://www.w3.org/2018/credentials/v1",
      "id": "https://credit-suisse.com/credentials/digital-assets/homium/approve",
      "type": ["VerifiableCredential"],
      "credentialSubject": {
        "id": "did:key:z6Mkh4Q8sq4kj9dUAK63j4vXfM2AMmvkz1qqGbNxXqBfHiez"
      },
      "issuer": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
      "issuanceDate": "2021-07-19T21:41:50Z",
      "proof": {
        "type": "Ed25519Signature2018",
        "proofPurpose": "assertionMethod",
        "verificationMethod": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL#z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
        "created": "2021-07-19T16:28:27.841Z",
        "jws": "eyJhbGciOiJFZERTQSIsImNyaXQiOlsiYjY0Il0sImI2NCI6ZmFsc2V9..t9N_yZbikIqApFSNRLW86fV0E-ue64Wb_62rTNTzAnLIYcC-X79eiloL5pCl565iORud2wWMekiM3Pp1LaP3Cw"
      }
    }
  },
  "options": {
    "verificationMethod": "did:key:z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL#z6Mkqrhc4U3LY47D88j8KYhXRY5eWgipTipmX6arXecykfpL",
    "proofPurpose": "authentication"
  }
}'
```


``` bash
didkit vc-issue-presentation --key-path homium-approver.jwk -p authentication -v did:key:z6Mkh4Q8sq4kj9dUAK63j4vXfM2AMmvkz1qqGbNxXqBfHiez#z6Mkh4Q8sq4kj9dUAK63j4vXfM2AMmvkz1qqGbNxXqBfHiez < presentation-unsigned.jsonld
```


